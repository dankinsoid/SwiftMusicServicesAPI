@testable import SoundCloudAPI
import XCTest
import SwiftAPIClient
import VDCodable

final class SoundCloudTests: XCTestCase {

    let api = SoundCloud.API(
        client: APIClient().loggingComponents(.full),
        clientID: SoundCloud.API.mobileWebClientID,
        redirectURI: SoundCloud.OAuth2.mobileWebRedirectURI,
        cache: MockSecureCacheService()
    )

    func testMe() async throws {
        try await dump(api.me())
    }

    func testLibrary() async throws {
        try await dump(api.me.library().first().collection[0])
    }
    
    func testLikes() async throws {
        try await dump(api.user("108168088").trackLikes().first().collection.first?.track.streamURL)
    }
    
    func testNewPlaylists() async throws {
        try await dump(api.createPlaylist(title: "Life Sucks", description: "Having a bad day? We know how it feels!", trackIDs: [1754372958,1564180549,1487044951,692259043,1154569264,270475967,775304593,1630882815,255984170,253501350,547711734,342393209,863079139,1257828847,256012172,512080026,698082787,1666282047,712499065,336582023,275469403,324707547,253219610,316533474,597146136,253876185,256269528,270519075,863080522,639280623,282586018,213950659,1358390092,1158699073,256051737,616549527,255770487,254407937,823997704,523920879,257047535,341416956,277502634,270475950,256177181,1112083495,270519100,282586022,715251067,526155132,256019928,341199320,590273133,257768887,40268326,774488863,343981072,256526269,1245701401,322762875,253631529,774799282,1471140619,257048409,863079604,256012188,170887405,611533452,254105160,680025608,255769662,12374878,310108191,1634470320,255867218,144189921,168055366,255783425,893851381,158805091,65660780,867555049,1154598160,256275326,861810298,254082112,323294450,400265007,527335215,255880420,350407471,294691551,793861750,353036501,257461491,285503750,768221662,1656824298,310108189,608142720,284874584,1385494663,311570519,730903012,679290048,254407929,215131716,256071640,1557967786,1234816912,1161987010,253611874,493091190,1217475433,7633926,256042918,1766119062,618388308,301981401,41180988,506276196,255770410,257060614,739343044,708438673,257899528,534154293,1476237559,7633922,1079239114,650307308,256272543,257062626,256074493,347575560,295726997,892455232,256204336,256170612,1452503740,1474581172,225537832,399688353,315930782,1375778461,506586924,256172399,1417767706,254226337,268165869,256620857,169975389,256119002,256175372,632256549,1241698612,685622299,256201357,256250320,323129472,257899532,418627228,891333550,1349224648,1438818355,257052874,256155868,1010965927,255828746,254105123,871508269,726433699,254016682,696663043,257060594,448209243,257052804,455342292,737719738,312394463,318279607,254158629,265032105,160972615,557159277,1370564629,700167235,179429458,664932542,202354570]))
    }
    
    func testSearch() async throws {
        try await dump(api.search.tracks("One Republic Everybody loves me").first().collection[0])
    }
    
    func testAdd() async throws {
			try await dump(api.addTracksToPlaylist(id: "2054517936", trackIDs: [1754372958,1564180549,1487044951,692259043,1154569264,270475967,775304593,1630882815,255984170,253501350,547711734,342393209,863079139,1257828847,256012172,512080026,698082787,1666282047,712499065,336582023,275469403,324707547,253219610,316533474,597146136,253876185,256269528,270519075,863080522,639280623,282586018,213950659,1358390092,1158699073,256051737,616549527,255770487,254407937,823997704,523920879,257047535,341416956,277502634,270475950,256177181,1112083495,270519100,282586022,715251067,526155132,256019928,341199320,590273133,257768887,40268326,774488863,343981072,256526269,1245701401,322762875,253631529,774799282,1471140619,257048409,863079604,256012188,170887405,611533452,254105160,680025608,255769662,12374878,310108191,1634470320,255867218,144189921,168055366,255783425,893851381,158805091,65660780,867555049,1154598160,256275326,861810298,254082112,323294450,400265007,527335215,255880420,350407471,294691551,793861750,353036501,257461491,285503750,768221662,1656824298,310108189,608142720,284874584,1385494663,311570519,730903012,679290048,254407929,215131716,256071640,1557967786,1234816912,1161987010,253611874,493091190,1217475433,7633926,256042918,1766119062,618388308,301981401,41180988,506276196,255770410,257060614,739343044,708438673,257899528,534154293,1476237559,7633922,1079239114,650307308,256272543,257062626,256074493,347575560,295726997,892455232,256204336,256170612,1452503740,1474581172,225537832,399688353,315930782,1375778461,506586924,256172399,1417767706,254226337,268165869,256620857,169975389,256119002,256175372,632256549,1241698612,685622299,256201357,256250320,323129472,257899532,418627228,891333550,1349224648,1438818355,257052874,256155868,1010965927,255828746,254105123,871508269,726433699,254016682,696663043,257060594,448209243,257052804,455342292,737719738,312394463,318279607,254158629,265032105,160972615,557159277,1370564629,700167235,179429458,664932542,202354570]))
    }
    
    func testPlaylist() async throws {
        try await dump(api.playlist(id: "1854804666").tracks)
    }
    
    func testStreamURL() async throws {
        let track = try await api.tracks([651714164]).first().collection[0]
        try await print(api.streamURL(url: track.streamURL!))
    }

    func testWaveform() async throws {
        let track = try await api.tracks([651714164]).first().collection[0]
        try await print(api.waveform(url: track.waveformURL!))
    }
}
