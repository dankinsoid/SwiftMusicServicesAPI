@testable import SoundCloudAPI
import SwiftAPIClient
import VDCodable
import XCTest

final class SoundCloudTests: XCTestCase {

	let api = SoundCloud.API(
		client: APIClient().loggingComponents(.full),
		clientID: SoundCloud.API.mobileWebClientID,
		redirectURI: SoundCloud.OAuth2.mobileWebRedirectURI,
		cache: MockSecureCacheService()
	)

	func testMe() async throws {
		try await dump(api.me())
	}

	func testLibrary() async throws {
		
		try await dump(api.me.library().first().collection[0])
	}

	func testLikes() async throws {
		try await dump(api.user("108168088").trackLikes().first().collection.first?.track.streamURL)
	}

	func testNewPlaylists() async throws {
		try await dump(api.createPlaylist(title: "Life Sucks", description: "Having a bad day? We know how it feels!", trackIDs: [1_754_372_958, 1_564_180_549, 1_487_044_951, 692_259_043, 1_154_569_264, 270_475_967, 775_304_593, 1_630_882_815, 255_984_170, 253_501_350, 547_711_734, 342_393_209, 863_079_139, 1_257_828_847, 256_012_172, 512_080_026, 698_082_787, 1_666_282_047, 712_499_065, 336_582_023, 275_469_403, 324_707_547, 253_219_610, 316_533_474, 597_146_136, 253_876_185, 256_269_528, 270_519_075, 863_080_522, 639_280_623, 282_586_018, 213_950_659, 1_358_390_092, 1_158_699_073, 256_051_737, 616_549_527, 255_770_487, 254_407_937, 823_997_704, 523_920_879, 257_047_535, 341_416_956, 277_502_634, 270_475_950, 256_177_181, 1_112_083_495, 270_519_100, 282_586_022, 715_251_067, 526_155_132, 256_019_928, 341_199_320, 590_273_133, 257_768_887, 40_268_326, 774_488_863, 343_981_072, 256_526_269, 1_245_701_401, 322_762_875, 253_631_529, 774_799_282, 1_471_140_619, 257_048_409, 863_079_604, 256_012_188, 170_887_405, 611_533_452, 254_105_160, 680_025_608, 255_769_662, 12_374_878, 310_108_191, 1_634_470_320, 255_867_218, 144_189_921, 168_055_366, 255_783_425, 893_851_381, 158_805_091, 65_660_780, 867_555_049, 1_154_598_160, 256_275_326, 861_810_298, 254_082_112, 323_294_450, 400_265_007, 527_335_215, 255_880_420, 350_407_471, 294_691_551, 793_861_750, 353_036_501, 257_461_491, 285_503_750, 768_221_662, 1_656_824_298, 310_108_189, 608_142_720, 284_874_584, 1_385_494_663, 311_570_519, 730_903_012, 679_290_048, 254_407_929, 215_131_716, 256_071_640, 1_557_967_786, 1_234_816_912, 1_161_987_010, 253_611_874, 493_091_190, 1_217_475_433, 7_633_926, 256_042_918, 1_766_119_062, 618_388_308, 301_981_401, 41_180_988, 506_276_196, 255_770_410, 257_060_614, 739_343_044, 708_438_673, 257_899_528, 534_154_293, 1_476_237_559, 7_633_922, 1_079_239_114, 650_307_308, 256_272_543, 257_062_626, 256_074_493, 347_575_560, 295_726_997, 892_455_232, 256_204_336, 256_170_612, 1_452_503_740, 1_474_581_172, 225_537_832, 399_688_353, 315_930_782, 1_375_778_461, 506_586_924, 256_172_399, 1_417_767_706, 254_226_337, 268_165_869, 256_620_857, 169_975_389, 256_119_002, 256_175_372, 632_256_549, 1_241_698_612, 685_622_299, 256_201_357, 256_250_320, 323_129_472, 257_899_532, 418_627_228, 891_333_550, 1_349_224_648, 1_438_818_355, 257_052_874, 256_155_868, 1_010_965_927, 255_828_746, 254_105_123, 871_508_269, 726_433_699, 254_016_682, 696_663_043, 257_060_594, 448_209_243, 257_052_804, 455_342_292, 737_719_738, 312_394_463, 318_279_607, 254_158_629, 265_032_105, 160_972_615, 557_159_277, 1_370_564_629, 700_167_235, 179_429_458, 664_932_542, 202_354_570]))
	}

	func testSearch() async throws {
		try await dump(api.search.tracks("One Republic Everybody loves me").first().collection[0])
	}

	func testAdd() async throws {
		try await dump(api.addTracksToPlaylist(id: "2054517936", trackIDs: [1_754_372_958, 1_564_180_549, 1_487_044_951, 692_259_043, 1_154_569_264, 270_475_967, 775_304_593, 1_630_882_815, 255_984_170, 253_501_350, 547_711_734, 342_393_209, 863_079_139, 1_257_828_847, 256_012_172, 512_080_026, 698_082_787, 1_666_282_047, 712_499_065, 336_582_023, 275_469_403, 324_707_547, 253_219_610, 316_533_474, 597_146_136, 253_876_185, 256_269_528, 270_519_075, 863_080_522, 639_280_623, 282_586_018, 213_950_659, 1_358_390_092, 1_158_699_073, 256_051_737, 616_549_527, 255_770_487, 254_407_937, 823_997_704, 523_920_879, 257_047_535, 341_416_956, 277_502_634, 270_475_950, 256_177_181, 1_112_083_495, 270_519_100, 282_586_022, 715_251_067, 526_155_132, 256_019_928, 341_199_320, 590_273_133, 257_768_887, 40_268_326, 774_488_863, 343_981_072, 256_526_269, 1_245_701_401, 322_762_875, 253_631_529, 774_799_282, 1_471_140_619, 257_048_409, 863_079_604, 256_012_188, 170_887_405, 611_533_452, 254_105_160, 680_025_608, 255_769_662, 12_374_878, 310_108_191, 1_634_470_320, 255_867_218, 144_189_921, 168_055_366, 255_783_425, 893_851_381, 158_805_091, 65_660_780, 867_555_049, 1_154_598_160, 256_275_326, 861_810_298, 254_082_112, 323_294_450, 400_265_007, 527_335_215, 255_880_420, 350_407_471, 294_691_551, 793_861_750, 353_036_501, 257_461_491, 285_503_750, 768_221_662, 1_656_824_298, 310_108_189, 608_142_720, 284_874_584, 1_385_494_663, 311_570_519, 730_903_012, 679_290_048, 254_407_929, 215_131_716, 256_071_640, 1_557_967_786, 1_234_816_912, 1_161_987_010, 253_611_874, 493_091_190, 1_217_475_433, 7_633_926, 256_042_918, 1_766_119_062, 618_388_308, 301_981_401, 41_180_988, 506_276_196, 255_770_410, 257_060_614, 739_343_044, 708_438_673, 257_899_528, 534_154_293, 1_476_237_559, 7_633_922, 1_079_239_114, 650_307_308, 256_272_543, 257_062_626, 256_074_493, 347_575_560, 295_726_997, 892_455_232, 256_204_336, 256_170_612, 1_452_503_740, 1_474_581_172, 225_537_832, 399_688_353, 315_930_782, 1_375_778_461, 506_586_924, 256_172_399, 1_417_767_706, 254_226_337, 268_165_869, 256_620_857, 169_975_389, 256_119_002, 256_175_372, 632_256_549, 1_241_698_612, 685_622_299, 256_201_357, 256_250_320, 323_129_472, 257_899_532, 418_627_228, 891_333_550, 1_349_224_648, 1_438_818_355, 257_052_874, 256_155_868, 1_010_965_927, 255_828_746, 254_105_123, 871_508_269, 726_433_699, 254_016_682, 696_663_043, 257_060_594, 448_209_243, 257_052_804, 455_342_292, 737_719_738, 312_394_463, 318_279_607, 254_158_629, 265_032_105, 160_972_615, 557_159_277, 1_370_564_629, 700_167_235, 179_429_458, 664_932_542, 202_354_570]))
	}

	func testPlaylist() async throws {
		try await dump(api.playlist(id: "1854804666").tracks)
	}

	func testStreamURL() async throws {
		let track = try await api.tracks([651_714_164]).first().collection[0]
		try await print(api.streamURL(url: track.streamURL!))
	}

	func testWaveform() async throws {
		let track = try await api.tracks([651_714_164]).first().collection[0]
		try await print(api.waveform(url: track.waveformURL!))
	}
}
